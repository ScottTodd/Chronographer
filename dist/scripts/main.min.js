!function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){var i=e[s][1][t];return r(i?i:t)},c,c.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e){"use strict";var i=function(t,e,i){this.chronographer=t,this.totalPlayTime=i&&i.playTime||10,this.paused=!0,this.loop=!0,this.dateFormat=i&&i.dateFormat||"string";var n=document.querySelector('link[rel="import"]').import,r=n.getElementById("chrono-controls-root");e.appendChild(r),this.controls=document.getElementById("chrono-controls"),this.vrControls=document.getElementById("chrono-vr-controls"),this.playPause=document.getElementById("chrono-playPauseButton"),this.enterVR=document.getElementById("chrono-enterVRButton"),this.timeInput=document.getElementById("chrono-timeInput"),this.dateBox=document.getElementById("chrono-dateBox"),this.vrDateBox1=document.getElementById("chrono-vr-dateBox-1"),this.vrDateBox2=document.getElementById("chrono-vr-dateBox-2"),this.playPause.addEventListener("click",this.handlePlayPause.bind(this),!1),document.onkeypress=function(t){32===t.keyCode&&(t.preventDefault(),this.handlePlayPause())}.bind(this),this.timeInput.addEventListener("input",this.manualUpdateTime.bind(this),!1),this.enterVR.addEventListener("click",this.handleEnterVR.bind(this),!1),document.addEventListener("fullscreenchange",this.fullscreenChangeHandler.bind(this),!1),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler.bind(this),!1),document.addEventListener("mozfullscreenchange",this.fullscreenChangeHandler.bind(this),!1)};i.prototype.getTime=function(){return parseFloat(this.timeInput.value)},i.prototype.setTimeRange=function(t,e){this.minTime=t,this.maxTime=e,this.timeRange=e-t,this.timeInput.setAttribute("min",t),this.timeInput.setAttribute("max",e),this.setInputTime(t)},i.prototype.manualUpdateTime=function(){this.setPaused(!0),this.updateTimeDisplay()},i.prototype.setInputTime=function(t){var e=Math.max(Math.min(t,this.maxTime),this.minTime);this.timeInput.value=e,this.updateTimeDisplay()},i.prototype.updateTimeDisplay=function(){var t="";if("timestamp"===this.dateFormat){var e=new Date(parseFloat(this.timeInput.value));t=this.getFormattedDate(e)}else t=Math.round(parseFloat(this.timeInput.value));this.dateBox.textContent=t,this.vrDateBox1.textContent=t,this.vrDateBox2.textContent=t},i.prototype.getFormattedDate=function(t){var e=t.getFullYear(),i=(1+t.getMonth()).toString();i=i.length>1?i:"0"+i;var n=t.getDate().toString();return n=n.length>1?n:"0"+n,e+"/"+i+"/"+n},i.prototype.handlePlayPause=function(){this.loop=!1,this.setPaused(!this.paused),parseFloat(this.timeInput.value)>=this.maxTime&&(this.setPaused(!0),this.setInputTime(this.minTime))},i.prototype.setPaused=function(t){this.paused=t,this.playPause.value=this.paused?"Play":"Pause"},i.prototype.handleEnterVR=function(){this.chronographer.enterVR(),this.setPaused(!1),this.loop=!0,this.controls.style.display="none",this.vrControls.style.display="inline-block"},i.prototype.handleLeaveVR=function(){this.chronographer.leaveVR(),this.setPaused(!0),this.loop=!1,this.controls.style.display="inline-block",this.vrControls.style.display="none"},i.prototype.fullscreenChangeHandler=function(){var t=document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement;t||this.handleLeaveVR()},i.prototype.update=function(t){if(!this.paused){var e=this.timeRange/this.totalPlayTime*t,i=parseFloat(this.timeInput.value)+e;this.setInputTime(i),i>=this.maxTime&&(this.loop?this.setInputTime(this.minTime):(this.setPaused(!0),this.playPause.value="Restart"))}},e.exports=i},{}],2:[function(t,e){"use strict";var i=t("./shaders/chronodataVertex"),n=t("./shaders/chronodataFragment"),r=function(t,e){function r(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.overrideMimeType("text/plain"),e.send(),e.responseText}function o(t,e){return t.time<e.time?-1:t.time>e.time?1:0}this.radius=t,this.data=[];var s=[];this.geometry=new THREE.Geometry,this.minTime=Number.MAX_VALUE,this.maxTime=0;var a=[];if(e&&e.dataURL){var h=JSON.parse(r(e.dataURL));a=h.locations}e&&e.dataJSON&&(a=e.dataJSON.locations);for(var l=0;l<a.length;++l){var c=parseFloat(a[l].timestampMs)||a[l].Year;this.minTime=Math.min(c,this.minTime),this.maxTime=Math.max(c,this.maxTime);var u=a[l].latitudeE7/1e7||a[l].Latitude,m=a[l].longitudeE7/1e7||a[l].Longitude,p=Math.PI/180,d=u*p,v=(180-m)*p,f=1.01*this.radius*Math.cos(d)*Math.cos(v),g=1.01*this.radius*Math.sin(d),y=1.01*this.radius*Math.cos(d)*Math.sin(v);this.data.push({lat:u,"long":m,position:[f,g,y],time:c}),s.push(c),this.geometry.vertices.push(new THREE.Vector3(f,g,y))}var x={pointTime:{type:"f",value:s}},T={particleTexture:{type:"t",value:THREE.ImageUtils.loadTexture("images/circle_alpha.png")},visualizationTime:{type:"f",value:this.minTime},minTime:{type:"f",value:this.minTime},maxTime:{type:"f",value:this.maxTime},percentHighlightRange:{type:"f",value:e&&e.percentHighlightRange||.1},minAlpha:{type:"f",value:e&&e.minAlpha||1},maxAlpha:{type:"f",value:e&&e.maxAlpha||1},minColor:{type:"c",value:e&&e.minColor||new THREE.Color(2236962)},maxColor:{type:"c",value:e&&e.maxColor||new THREE.Color(15658734)},minSize:{type:"f",value:e&&e.minSize||12},maxSize:{type:"f",value:e&&e.maxSize||32}};this.material=new THREE.ShaderMaterial({attributes:x,uniforms:T,vertexShader:i,fragmentShader:n,transparent:!0,blending:THREE.NormalBlending,depthWrite:!1}),this.particles=new THREE.PointCloud(this.geometry,this.material),this.data.sort(o)};r.prototype.setScene=function(t){this.scene=t,t.add(this.particles)},r.prototype.update=function(){},r.prototype.setTime=function(t){this.currentTime=t,this.material.uniforms.visualizationTime.value=t},r.prototype.getCurrentTime=function(){return this.currentTime},r.prototype.getMinTime=function(){return this.minTime},r.prototype.getMaxTime=function(){return this.maxTime},r.prototype.getData=function(){return this.data},e.exports=r},{"./shaders/chronodataFragment":8,"./shaders/chronodataVertex":9}],3:[function(t,e){"use strict";var i=t("./ChronoData"),n=t("./ChronoControls"),r=t("./DeviceOrbitControls"),o=t("./Earth"),s=t("./FollowLine"),a=function(t,e){Detector.webgl||Detector.addGetWebGLMessage(),this.container=t,this.width=window.innerWidth,this.height=window.innerHeight,this.radius=1e3,this.vr=!1,this.setupRenderer(),this.setupScene(),this.chronoData=new i(this.radius,e),this.chronoData.setScene(this.scene);var r=this.chronoData.getMinTime(),a=this.chronoData.getMaxTime();this.chronoControls=new n(this,t,e),this.chronoControls.setTimeRange(r,a),this.earth=new o(this.radius),this.earth.setScene(this.scene),e.followLine&&(this.followLine=new s(this.chronoData,this.radius),this.followLine.setScene(this.scene))};a.prototype.setupRenderer=function(){this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.container.appendChild(this.renderer.domElement),this.renderer.domElement.id="cgr-chronoData",this.effect=new THREE.StereoEffect(this.renderer),this.effect.setSize(this.width,this.height)},a.prototype.onWindowResize=function(){this.width=window.innerWidth,this.height=window.innerHeight,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.effect.setSize(this.width,this.height)},a.prototype.setOrientationControls=function(){this.controls=this.deviceOrbitControls,this.orbitControls.enabled=!1,this.deviceOrbitControls.enabled=!0},a.prototype.setOrbitControls=function(){this.controls=this.orbitControls,this.orbitControls.enabled=!0,this.deviceOrbitControls.enabled=!1},a.prototype.enterVR=function(){this.vr=!0,this.fullscreen(),this.setOrientationControls()},a.prototype.leaveVR=function(){this.vr=!1,this.setOrbitControls()},a.prototype.fullscreen=function(){this.container.requestFullscreen?this.container.requestFullscreen():this.container.msRequestFullscreen?this.container.msRequestFullscreen():this.container.mozRequestFullScreen?this.container.mozRequestFullScreen():this.container.webkitRequestFullscreen&&this.container.webkitRequestFullscreen();var t=["landscape-primary","landscape-secondary"];screen.lockOrientation?screen.lockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation?screen.msLockOrientation(t):screen.orientation.lock&&screen.orientation.lock(t)},a.prototype.setupScene=function(){this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,3e4),this.camera.position.z=-(1.5*this.radius),this.camera.position.y=1.2*this.radius,this.camera.lookAt(this.scene.position),this.deviceOrbitControls=new r(this.camera,2*this.radius),this.orbitControls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.orbitControls.addEventListener("change",this.render.bind(this)),this.orbitControls.noPan=!0,this.orbitControls.rotateSpeed=.5,this.setOrbitControls();var t=new THREE.AmbientLight(8947848);this.scene.add(t);var e=new THREE.DirectionalLight(13421772,.2);e.position.set(5,3,5),this.scene.add(e),this.clock=new THREE.Clock,window.addEventListener("resize",this.onWindowResize.bind(this),!1)},a.prototype.update=function(){var t=this.clock.getDelta();this.chronoControls.update(t),this.chronoData.setTime(this.chronoControls.getTime()),this.chronoData.update(t),this.followLine&&this.followLine.update(t),this.controls.update(t),this.render()},a.prototype.render=function(){this.renderer.clear(),this.vr?this.effect.render(this.scene,this.camera):this.renderer.render(this.scene,this.camera)},e.exports=a},{"./ChronoControls":1,"./ChronoData":2,"./DeviceOrbitControls":4,"./Earth":5,"./FollowLine":6}],4:[function(t,e){"use strict";var i=function(t,e){this.enabled=!0,this.camera=t,this.radius=e,window.addEventListener("deviceorientation",this.setOrientation.bind(this),!1)};i.prototype.setOrientation=function(t){if(this.enabled){var e=Math.PI/180,i=-(t.alpha*e),n=(t.gamma+90)*e,r=this.radius*Math.cos(n)*Math.cos(i),o=this.radius*Math.sin(n),s=this.radius*Math.cos(n)*Math.sin(i);this.camera.position.set(r,o,s),this.camera.lookAt(new THREE.Vector3(0,0,0))}},i.prototype.update=function(){},e.exports=i},{}],5:[function(t,e){"use strict";var i=function(t){var e=new THREE.SphereGeometry(t,80,60),i=new THREE.MeshPhongMaterial({map:this.loadTexture("earth_diffuse_4k.jpg")});i.bumpMap=this.loadTexture("earth_bump_4k.jpg"),i.bumpScale=t/2,i.specularMap=this.loadTexture("earth_specular_2k.jpg"),i.specular=new THREE.Color(3815994),this.earthMesh=new THREE.Mesh(e,i),this.earthMesh.rotation.y=Math.PI;var n=new THREE.MeshBasicMaterial({map:this.loadTexture("earth_boundaries_2k.png"),transparent:!0,opacity:.5});this.boundariesMesh=new THREE.Mesh(e,n),this.boundariesMesh.rotation.y=Math.PI};i.prototype.setScene=function(t){this.scene=t,t.add(this.earthMesh),t.add(this.boundariesMesh)},i.prototype.loadTexture=function(t){return THREE.ImageUtils.loadTexture("../../dist/images/"+t)},e.exports=i},{}],6:[function(t,e){"use strict";var i=function(t,e){this.chronoData=t,this.radius=e,this.maxPoints=1e3,this.curve=new THREE.SplineCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0)]),this.curvePoints=[],this.curveGeometry=new THREE.Geometry,this.curveGeometry.vertices=this.curve.getPoints(200),this.curveMaterial=new THREE.LineBasicMaterial({color:13421772}),this.line=new THREE.Line(this.curveGeometry,this.curveMaterial),this.data=t.getData(),this.lastTime=t.getMinTime(),this.currentDataIndex=0};i.prototype.setScene=function(t){this.scene=t,t.add(this.line)},i.prototype.update=function(){var t=this.chronoData.getCurrentTime();for(t<this.lastTime&&this.reset(t);t>this.data[this.currentDataIndex].time;)this.currentDataIndex++,this.addPoint();this.lastTime=t},i.prototype.reset=function(t){for(this.curvePoints=[],this.currentDataIndex=0;t>this.data[this.currentDataIndex].time;)this.currentDataIndex++},i.prototype.addPoint=function(){var t=this.data[this.currentDataIndex].position;this.curvePoints.push(new THREE.Vector3(t[0],t[1],t[2])),this.curvePoints.length>this.maxPoints&&this.curvePoints.shift(),this.curve=new THREE.SplineCurve3(this.curvePoints),this.curveGeometry.vertices=this.curve.getPoints(3*this.maxPoints),this.line.geometry.verticesNeedUpdate=!0},e.exports=i},{}],7:[function(t){var e=t("./Chronographer");window.Chronographer=e},{"./Chronographer":3}],8:[function(t,e){"use strict";var i="uniform sampler2D particleTexture; \n \nvarying float t; \nvarying vec3 timeColor; \nvarying float timeAlpha; \n \nvoid main() { \n    float textureAlpha = texture2D(particleTexture, gl_PointCoord).a; \n    float alpha = textureAlpha * timeAlpha; \n \n    vec3 color = timeColor; \n \n    gl_FragColor = vec4(color, alpha); \n} \n";e.exports=i},{}],9:[function(t,e){"use strict";var i="attribute float pointTime; \n \nuniform float minTime; \nuniform float maxTime; \nuniform float visualizationTime; \nuniform float percentHighlightRange; \n \nuniform float minAlpha; \nuniform float maxAlpha; \nuniform vec3 minColor; \nuniform vec3 maxColor; \nuniform float minSize; \nuniform float maxSize; \n \nvarying float t; \nvarying float timeAlpha; \nvarying vec3 timeColor; \n \nfloat lerp(float minValue, float maxValue, float t) { \n    return (minValue * (1.0 - t)) + (maxValue * t); \n} \n \nfloat inverseLerp(float value, float minValue, float maxValue) { \n    float valueRange = maxValue - minValue; \n    float inverseLerped = (value - minValue) / valueRange; \n    float clamped = clamp(inverseLerped, 0.0, 1.0); \n    return inverseLerped; \n} \n \n// RGB to HSV and HSV to RGB \n// source: http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl \nvec3 rgb2hsv(vec3 c) { \n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0); \n    vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy); \n    vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx); \n \n    float d = q.x - min(q.w, q.y); \n    float e = 1.0e-10; \n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x); \n} \n \nvec3 hsv2rgb(vec3 c) { \n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0); \n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www); \n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y); \n} \n \n \nvoid main() { \n    vec4 mvPosition = viewMatrix * vec4(position, 1.0); \n    gl_Position = projectionMatrix * mvPosition; \n \n    float vertexPercent = inverseLerp(pointTime, minTime, maxTime); \n    float visPercent = inverseLerp(visualizationTime, minTime, maxTime); \n    float percentDifference = abs(vertexPercent - visPercent); \n    // Scale difference based on highlight range into an interpolation time. \n    t = clamp(1.0 - percentDifference / percentHighlightRange, 0.0, 1.0); \n \n    gl_PointSize = lerp(minSize, maxSize, t); \n \n    timeAlpha = lerp(minAlpha, maxAlpha, t); \n \n    vec3 minHSV = rgb2hsv(minColor); \n    vec3 maxHSV = rgb2hsv(maxColor); \n    float h = lerp(minHSV.x, maxHSV.x, t); \n    float s = lerp(minHSV.y, maxHSV.y, t); \n    float v = lerp(minHSV.z, maxHSV.z, t); \n    timeColor = hsv2rgb(vec3(h, s, v)); \n} \n";e.exports=i},{}]},{},[7]);