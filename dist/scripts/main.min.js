!function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return r(i?i:e)},c,c.exports,e,t,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t){"use strict";var i=function(e,t,i){this.chronographer=e,this.totalPlayTime=i&&i.playTime||10,this.paused=!0,this.loop=!0,this.dateFormat=i&&i.dateFormat||"string";var n=document.querySelector('link[rel="import"]').import,r=n.getElementById("chrono-controls-root");t.appendChild(r),this.controls=document.getElementById("chrono-controls"),this.vrControls=document.getElementById("chrono-vr-controls"),this.playPause=document.getElementById("chrono-playPauseButton"),this.enterVR=document.getElementById("chrono-enterVRButton"),this.timeInput=document.getElementById("chrono-timeInput"),this.dateBox=document.getElementById("chrono-dateBox"),this.vrDateBox1=document.getElementById("chrono-vr-dateBox-1"),this.vrDateBox2=document.getElementById("chrono-vr-dateBox-2"),this.playPause.addEventListener("click",this.handlePlayPause.bind(this),!1),document.onkeypress=function(e){32===e.keyCode&&(e.preventDefault(),this.handlePlayPause())}.bind(this),this.timeInput.addEventListener("change",this.updateTimeDisplay.bind(this),!1),this.enterVR.addEventListener("click",this.handleEnterVR.bind(this),!1),document.addEventListener("fullscreenchange",this.fullscreenChangeHandler.bind(this),!1),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler.bind(this),!1),document.addEventListener("mozfullscreenchange",this.fullscreenChangeHandler.bind(this),!1)};i.prototype.getTime=function(){return parseFloat(this.timeInput.value)},i.prototype.setTimeRange=function(e,t){this.minTime=e,this.maxTime=t,this.timeRange=t-e,this.timeInput.setAttribute("min",e),this.timeInput.setAttribute("max",t),this.setInputTime(e)},i.prototype.setInputTime=function(e){var t=Math.max(Math.min(e,this.maxTime),this.minTime);this.timeInput.value=t,this.updateTimeDisplay()},i.prototype.updateTimeDisplay=function(){var e="";if("timestamp"===this.dateFormat){var t=new Date(parseFloat(this.timeInput.value));e=this.getFormattedDate(t)}else e=Math.round(parseFloat(this.timeInput.value));this.dateBox.textContent=e,this.vrDateBox1.textContent=e,this.vrDateBox2.textContent=e},i.prototype.getFormattedDate=function(e){var t=e.getFullYear(),i=(1+e.getMonth()).toString();i=i.length>1?i:"0"+i;var n=e.getDate().toString();return n=n.length>1?n:"0"+n,t+"/"+i+"/"+n},i.prototype.handlePlayPause=function(){this.loop=!1,this.paused=!this.paused,parseFloat(this.timeInput.value)>=this.maxTime&&(this.paused=!0,this.setInputTime(this.minTime)),this.playPause.value=this.paused?"Play":"Pause"},i.prototype.handleEnterVR=function(){this.chronographer.enterVR(),this.paused=!1,this.loop=!0,this.controls.style.display="none",this.vrControls.style.display="inline-block"},i.prototype.handleLeaveVR=function(){this.chronographer.leaveVR(),this.paused=!0,this.loop=!1,this.controls.style.display="inline-block",this.vrControls.style.display="none"},i.prototype.fullscreenChangeHandler=function(){var e=document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement;e||this.handleLeaveVR()},i.prototype.update=function(e){if(!this.paused){var t=this.timeRange/this.totalPlayTime*e,i=parseFloat(this.timeInput.value)+t;this.setInputTime(i),i>=this.maxTime&&(this.loop?this.setInputTime(this.minTime):this.paused=!0)}},t.exports=i},{}],2:[function(e,t){"use strict";var i=e("./shaders/chronodataVertex"),n=e("./shaders/chronodataFragment"),r=function(e,t,r){function o(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.overrideMimeType("text/plain"),t.send(),t.responseText}function s(e,t){return e.time<t.time?-1:e.time>t.time?1:0}this.radius=t,this.data=[];var a=[];this.geometry=new THREE.Geometry,this.minTime=Number.MAX_VALUE,this.maxTime=0;for(var h=JSON.parse(o(e)),l=h.locations,c=0;c<l.length;++c){var u=parseFloat(l[c].timestampMs)||l[c].Year;this.minTime=Math.min(u,this.minTime),this.maxTime=Math.max(u,this.maxTime);var m=l[c].latitudeE7/1e7||l[c].Latitude,p=l[c].longitudeE7/1e7||l[c].Longitude,d=Math.PI/180,v=m*d,f=(180-p)*d,g=1.01*this.radius*Math.cos(v)*Math.cos(f),y=1.01*this.radius*Math.sin(v),x=1.01*this.radius*Math.cos(v)*Math.sin(f);this.data.push({lat:m,"long":p,position:[g,y,x],time:u}),a.push(u),this.geometry.vertices.push(new THREE.Vector3(g,y,x))}var T={pointTime:{type:"f",value:a}},E={particleTexture:{type:"t",value:THREE.ImageUtils.loadTexture("images/circle_alpha.png")},visualizationTime:{type:"f",value:this.minTime},minTime:{type:"f",value:this.minTime},maxTime:{type:"f",value:this.maxTime},percentHighlightRange:{type:"f",value:r&&r.percentHighlightRange||.1},minAlpha:{type:"f",value:r&&r.minAlpha||1},maxAlpha:{type:"f",value:r&&r.maxAlpha||1},minColor:{type:"c",value:r&&r.minColor||new THREE.Color(2236962)},maxColor:{type:"c",value:r&&r.maxColor||new THREE.Color(15658734)},minSize:{type:"f",value:r&&r.minSize||12},maxSize:{type:"f",value:r&&r.maxSize||32}};this.material=new THREE.ShaderMaterial({attributes:T,uniforms:E,vertexShader:i,fragmentShader:n,transparent:!0,blending:THREE.NormalBlending,depthWrite:!1}),this.particles=new THREE.PointCloud(this.geometry,this.material),this.data.sort(s)};r.prototype.setScene=function(e){this.scene=e,e.add(this.particles)},r.prototype.update=function(){},r.prototype.setTime=function(e){this.currentTime=e,this.material.uniforms.visualizationTime.value=e},r.prototype.getCurrentTime=function(){return this.currentTime},r.prototype.getMinTime=function(){return this.minTime},r.prototype.getMaxTime=function(){return this.maxTime},r.prototype.getData=function(){return this.data},t.exports=r},{"./shaders/chronodataFragment":8,"./shaders/chronodataVertex":9}],3:[function(e,t){"use strict";var i=e("./ChronoData"),n=e("./ChronoControls"),r=e("./DeviceOrbitControls"),o=e("./Earth"),s=e("./FollowLine"),a=function(e,t,r){Detector.webgl||Detector.addGetWebGLMessage(),this.container=e,this.width=window.innerWidth,this.height=window.innerHeight,this.radius=1e3,this.vr=!1,this.setupRenderer(),this.setupScene(),this.chronoData=new i(t,this.radius,r),this.chronoData.setScene(this.scene);var a=this.chronoData.getMinTime(),h=this.chronoData.getMaxTime();this.chronoControls=new n(this,e,r),this.chronoControls.setTimeRange(a,h),this.earth=new o(this.radius),this.earth.setScene(this.scene),r.followLine&&(this.followLine=new s(this.chronoData,this.radius),this.followLine.setScene(this.scene))};a.prototype.setupRenderer=function(){this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.container.appendChild(this.renderer.domElement),this.renderer.domElement.id="cgr-chronoData",this.effect=new THREE.StereoEffect(this.renderer),this.effect.setSize(this.width,this.height)},a.prototype.onWindowResize=function(){this.width=window.innerWidth,this.height=window.innerHeight,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.effect.setSize(this.width,this.height)},a.prototype.setOrientationControls=function(){this.controls=this.deviceOrbitControls,this.orbitControls.enabled=!1,this.deviceOrbitControls.enabled=!0},a.prototype.setOrbitControls=function(){this.controls=this.orbitControls,this.orbitControls.enabled=!0,this.deviceOrbitControls.enabled=!1},a.prototype.enterVR=function(){this.vr=!0,this.fullscreen(),this.setOrientationControls()},a.prototype.leaveVR=function(){this.vr=!1,this.setOrbitControls()},a.prototype.fullscreen=function(){this.container.requestFullscreen?this.container.requestFullscreen():this.container.msRequestFullscreen?this.container.msRequestFullscreen():this.container.mozRequestFullScreen?this.container.mozRequestFullScreen():this.container.webkitRequestFullscreen&&this.container.webkitRequestFullscreen();var e=["landscape-primary","landscape-secondary"];screen.lockOrientation?screen.lockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):screen.msLockOrientation?screen.msLockOrientation(e):screen.orientation.lock&&screen.orientation.lock(e)},a.prototype.setupScene=function(){this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,3e4),this.camera.position.z=-(1.5*this.radius),this.camera.position.y=1.2*this.radius,this.camera.lookAt(this.scene.position),this.deviceOrbitControls=new r(this.camera,2*this.radius),this.orbitControls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.orbitControls.addEventListener("change",this.render.bind(this)),this.orbitControls.noPan=!0,this.orbitControls.rotateSpeed=.5,this.setOrbitControls();var e=new THREE.AmbientLight(8947848);this.scene.add(e);var t=new THREE.DirectionalLight(13421772,.2);t.position.set(5,3,5),this.scene.add(t),this.clock=new THREE.Clock,window.addEventListener("resize",this.onWindowResize.bind(this),!1)},a.prototype.update=function(){var e=this.clock.getDelta();this.chronoControls.update(e),this.chronoData.setTime(this.chronoControls.getTime()),this.chronoData.update(e),this.followLine&&this.followLine.update(e),this.controls.update(e),this.render()},a.prototype.render=function(){this.renderer.clear(),this.vr?this.effect.render(this.scene,this.camera):this.renderer.render(this.scene,this.camera)},t.exports=a},{"./ChronoControls":1,"./ChronoData":2,"./DeviceOrbitControls":4,"./Earth":5,"./FollowLine":6}],4:[function(e,t){"use strict";var i=function(e,t){this.enabled=!0,this.camera=e,this.radius=t,window.addEventListener("deviceorientation",this.setOrientation.bind(this),!1)};i.prototype.setOrientation=function(e){if(this.enabled){var t=Math.PI/180,i=-(e.alpha*t),n=(e.gamma+90)*t,r=this.radius*Math.cos(n)*Math.cos(i),o=this.radius*Math.sin(n),s=this.radius*Math.cos(n)*Math.sin(i);this.camera.position.set(r,o,s),this.camera.lookAt(new THREE.Vector3(0,0,0))}},i.prototype.update=function(){},t.exports=i},{}],5:[function(e,t){"use strict";var i=function(e){var t=new THREE.SphereGeometry(e,80,60),i=new THREE.MeshPhongMaterial({map:this.loadTexture("earth_diffuse_4k.jpg")});i.bumpMap=this.loadTexture("earth_bump_4k.jpg"),i.bumpScale=e/2,i.specularMap=this.loadTexture("earth_specular_4k.jpg"),i.specular=new THREE.Color(3815994),this.earthMesh=new THREE.Mesh(t,i),this.earthMesh.rotation.y=Math.PI;var n=new THREE.MeshBasicMaterial({map:this.loadTexture("earth_boundaries_4k.png"),transparent:!0,opacity:.5});this.boundariesMesh=new THREE.Mesh(t,n),this.boundariesMesh.rotation.y=Math.PI};i.prototype.setScene=function(e){this.scene=e,e.add(this.earthMesh),e.add(this.boundariesMesh)},i.prototype.loadTexture=function(e){return THREE.ImageUtils.loadTexture("../../dist/images/"+e)},t.exports=i},{}],6:[function(e,t){"use strict";var i=function(e,t){this.chronoData=e,this.radius=t,this.maxPoints=1e3,this.curve=new THREE.SplineCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0)]),this.curvePoints=[],this.curveGeometry=new THREE.Geometry,this.curveGeometry.vertices=this.curve.getPoints(200),this.curveMaterial=new THREE.LineBasicMaterial({color:13421772}),this.line=new THREE.Line(this.curveGeometry,this.curveMaterial),this.data=e.getData(),this.lastTime=e.getMinTime(),this.currentDataIndex=0};i.prototype.setScene=function(e){this.scene=e,e.add(this.line)},i.prototype.update=function(){var e=this.chronoData.getCurrentTime();for(e<this.lastTime&&this.reset(e);e>this.data[this.currentDataIndex].time;)this.currentDataIndex++,this.addPoint();this.lastTime=e},i.prototype.reset=function(e){for(this.curvePoints=[],this.currentDataIndex=0;e>this.data[this.currentDataIndex].time;)this.currentDataIndex++},i.prototype.addPoint=function(){var e=this.data[this.currentDataIndex].position;this.curvePoints.push(new THREE.Vector3(e[0],e[1],e[2])),this.curvePoints.length>this.maxPoints&&this.curvePoints.shift(),this.curve=new THREE.SplineCurve3(this.curvePoints),this.curveGeometry.vertices=this.curve.getPoints(3*this.maxPoints),this.line.geometry.verticesNeedUpdate=!0},t.exports=i},{}],7:[function(e){var t=e("./Chronographer");window.Chronographer=t},{"./Chronographer":3}],8:[function(e,t){"use strict";var i="uniform sampler2D particleTexture; \n \nvarying float t; \nvarying vec3 timeColor; \nvarying float timeAlpha; \n \nvoid main() { \n    float textureAlpha = texture2D(particleTexture, gl_PointCoord).a; \n    float alpha = textureAlpha * timeAlpha; \n \n    vec3 color = timeColor; \n \n    gl_FragColor = vec4(color, alpha); \n} \n";t.exports=i},{}],9:[function(e,t){"use strict";var i="attribute float pointTime; \n \nuniform float minTime; \nuniform float maxTime; \nuniform float visualizationTime; \nuniform float percentHighlightRange; \n \nuniform float minAlpha; \nuniform float maxAlpha; \nuniform vec3 minColor; \nuniform vec3 maxColor; \nuniform float minSize; \nuniform float maxSize; \n \nvarying float t; \nvarying float timeAlpha; \nvarying vec3 timeColor; \n \nfloat lerp(float minValue, float maxValue, float t) { \n    return (minValue * (1.0 - t)) + (maxValue * t); \n} \n \nfloat inverseLerp(float value, float minValue, float maxValue) { \n    float valueRange = maxValue - minValue; \n    float inverseLerped = (value - minValue) / valueRange; \n    float clamped = clamp(inverseLerped, 0.0, 1.0); \n    return inverseLerped; \n} \n \n// RGB to HSV and HSV to RGB \n// source: http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl \nvec3 rgb2hsv(vec3 c) { \n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0); \n    vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy); \n    vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx); \n \n    float d = q.x - min(q.w, q.y); \n    float e = 1.0e-10; \n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x); \n} \n \nvec3 hsv2rgb(vec3 c) { \n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0); \n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www); \n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y); \n} \n \n \nvoid main() { \n    vec4 mvPosition = viewMatrix * vec4(position, 1.0); \n    gl_Position = projectionMatrix * mvPosition; \n \n    float vertexPercent = inverseLerp(pointTime, minTime, maxTime); \n    float visPercent = inverseLerp(visualizationTime, minTime, maxTime); \n    float percentDifference = abs(vertexPercent - visPercent); \n    // Scale difference based on highlight range into an interpolation time. \n    t = clamp(1.0 - percentDifference / percentHighlightRange, 0.0, 1.0); \n \n    gl_PointSize = lerp(minSize, maxSize, t); \n \n    timeAlpha = lerp(minAlpha, maxAlpha, t); \n \n    vec3 minHSV = rgb2hsv(minColor); \n    vec3 maxHSV = rgb2hsv(maxColor); \n    float h = lerp(minHSV.x, maxHSV.x, t); \n    float s = lerp(minHSV.y, maxHSV.y, t); \n    float v = lerp(minHSV.z, maxHSV.z, t); \n    timeColor = hsv2rgb(vec3(h, s, v)); \n} \n";t.exports=i},{}]},{},[7]);